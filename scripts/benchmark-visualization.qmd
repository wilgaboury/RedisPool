---
title: "Benchmark Visualzations"
format: html
editor: visual
---

## Install Packages

```{r}
install.packages("tidyverse")
```

## Use Packages

```{r}
library(tidyverse)
```

## Read In Data

This step requires that `cargo bench` and `collect-bench.py` have been run.

```{r}
data <- read.csv('benchmark.csv')
```

## Reshape and Clean Data

```{r}
clean <- data %>%
  extract(name, c("pool_size", "con_lim"), "^\\w*_(\\d*)_\\w*_(\\d*|\\w*)") %>%
  mutate(per_val = val / itr, across(c(pool_size, con_lim), as.numeric)) %>%
  select(-val, -itr) %>%
  rename(val = per_val, name = bench)

# debug info
# str(clean)

# output to file
# write.csv(clean, "clean_benchmark.csv", row.names=FALSE)
```

```{r}
clean %>% 
  filter(name == "parallel_throughput") %>%
  mutate(val = 1/(val/1e9)) %>%
  ggplot(aes(x=pool_size, y=val, color=factor(con_lim))) + 
    geom_point() +
    geom_smooth(method=glm, family=binomial, aes(group = con_lim)) +
    scale_x_log10()
```

```{r}
clean %>% 
  filter(name == "parallel_latency") %>%
  ggplot(aes(x=pool_size, y=val, color=factor(con_lim))) + 
    geom_point() +
    geom_smooth(method=glm, family=binomial, aes(group = con_lim)) +
    scale_x_log10()
```